var Cr=Object.create;var ie=Object.defineProperty;var Nr=Object.getOwnPropertyDescriptor;var kr=Object.getOwnPropertyNames;var Lr=Object.getPrototypeOf,Pr=Object.prototype.hasOwnProperty;var y=(t,e)=>()=>(t&&(e=t(t=0)),e);var S=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Rr=(t,e)=>{for(var r in e)ie(t,r,{get:e[r],enumerable:!0})},Xe=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of kr(e))!Pr.call(t,s)&&s!==r&&ie(t,s,{get:()=>e[s],enumerable:!(i=Nr(e,s))||i.enumerable});return t};var ye=(t,e,r)=>(r=t!=null?Cr(Lr(t)):{},Xe(e||!t||!t.__esModule?ie(r,"default",{value:t,enumerable:!0}):r,t)),Ur=t=>Xe(ie({},"__esModule",{value:!0}),t);var L=S((ri,Ke)=>{"use strict";Ke.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var j=S((si,Se)=>{"use strict";var{EMPTY_BUFFER:Ir}=L();function Ze(t,e){if(t.length===0)return Ir;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),i=0;for(let s=0;s<t.length;s++){let n=t[s];r.set(n,i),i+=n.length}return i<e?r.slice(0,i):r}function Je(t,e,r,i,s){for(let n=0;n<s;n++)r[i+n]=t[n]^e[n&3]}function Qe(t,e){for(let r=0;r<t.length;r++)t[r]^=e[r&3]}function et(t){return t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function ne(t){if(ne.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=Buffer.from(t):ArrayBuffer.isView(t)?e=Buffer.from(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),ne.readOnly=!1),e}try{let t=require("bufferutil");Se.exports={concat:Ze,mask(e,r,i,s,n){n<48?Je(e,r,i,s,n):t.mask(e,r,i,s,n)},toArrayBuffer:et,toBuffer:ne,unmask(e,r){e.length<32?Qe(e,r):t.unmask(e,r)}}}catch{Se.exports={concat:Ze,mask:Je,toArrayBuffer:et,toBuffer:ne,unmask:Qe}}});var st=S((ii,rt)=>{"use strict";var tt=Symbol("kDone"),ve=Symbol("kRun"),Ee=class{constructor(e){this[tt]=()=>{this.pending--,this[ve]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[ve]()}[ve](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[tt])}}};rt.exports=Ee});var z=S((ni,at)=>{"use strict";var V=require("zlib"),it=j(),Dr=st(),{kStatusCode:nt}=L(),Ar=Buffer.from([0,0,255,255]),le=Symbol("permessage-deflate"),w=Symbol("total-length"),H=Symbol("callback"),P=Symbol("buffers"),ae=Symbol("error"),oe,be=class{constructor(e,r,i){if(this._maxPayload=i|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!oe){let s=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;oe=new Dr(s)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[H];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,i=e.find(s=>!(r.serverNoContextTakeover===!1&&s.server_no_context_takeover||s.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>s.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!s.client_max_window_bits));if(!i)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(i.server_no_context_takeover=!0),r.clientNoContextTakeover&&(i.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(i.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?i.client_max_window_bits=r.clientMaxWindowBits:(i.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete i.client_max_window_bits,i}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(i=>{let s=r[i];if(s.length>1)throw new Error(`Parameter "${i}" must have only a single value`);if(s=s[0],i==="client_max_window_bits"){if(s!==!0){let n=+s;if(!Number.isInteger(n)||n<8||n>15)throw new TypeError(`Invalid value for parameter "${i}": ${s}`);s=n}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${i}": ${s}`)}else if(i==="server_max_window_bits"){let n=+s;if(!Number.isInteger(n)||n<8||n>15)throw new TypeError(`Invalid value for parameter "${i}": ${s}`);s=n}else if(i==="client_no_context_takeover"||i==="server_no_context_takeover"){if(s!==!0)throw new TypeError(`Invalid value for parameter "${i}": ${s}`)}else throw new Error(`Unknown parameter "${i}"`);r[i]=s})}),e}decompress(e,r,i){oe.add(s=>{this._decompress(e,r,(n,o)=>{s(),i(n,o)})})}compress(e,r,i){oe.add(s=>{this._compress(e,r,(n,o)=>{s(),i(n,o)})})}_decompress(e,r,i){let s=this._isServer?"client":"server";if(!this._inflate){let n=`${s}_max_window_bits`,o=typeof this.params[n]!="number"?V.Z_DEFAULT_WINDOWBITS:this.params[n];this._inflate=V.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[le]=this,this._inflate[w]=0,this._inflate[P]=[],this._inflate.on("error",Mr),this._inflate.on("data",ot)}this._inflate[H]=i,this._inflate.write(e),r&&this._inflate.write(Ar),this._inflate.flush(()=>{let n=this._inflate[ae];if(n){this._inflate.close(),this._inflate=null,i(n);return}let o=it.concat(this._inflate[P],this._inflate[w]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[w]=0,this._inflate[P]=[],r&&this.params[`${s}_no_context_takeover`]&&this._inflate.reset()),i(null,o)})}_compress(e,r,i){let s=this._isServer?"server":"client";if(!this._deflate){let n=`${s}_max_window_bits`,o=typeof this.params[n]!="number"?V.Z_DEFAULT_WINDOWBITS:this.params[n];this._deflate=V.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[w]=0,this._deflate[P]=[],this._deflate.on("data",Br)}this._deflate[H]=i,this._deflate.write(e),this._deflate.flush(V.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let n=it.concat(this._deflate[P],this._deflate[w]);r&&(n=n.slice(0,n.length-4)),this._deflate[H]=null,this._deflate[w]=0,this._deflate[P]=[],r&&this.params[`${s}_no_context_takeover`]&&this._deflate.reset(),i(null,n)})}};at.exports=be;function Br(t){this[P].push(t),this[w]+=t.length}function ot(t){if(this[w]+=t.length,this[le]._maxPayload<1||this[w]<=this[le]._maxPayload){this[P].push(t);return}this[ae]=new RangeError("Max payload size exceeded"),this[ae].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[ae][nt]=1009,this.removeListener("data",ot),this.reset()}function Mr(t){this[le]._inflate=null,t[nt]=1007,this[H](t)}});var Y=S((oi,we)=>{"use strict";var lt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function ft(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function ct(t){let e=t.length,r=0;for(;r<e;)if(!(t[r]&128))r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}try{let t=require("utf-8-validate");we.exports={isValidStatusCode:ft,isValidUTF8(e){return e.length<150?ct(e):t(e)},tokenChars:lt}}catch{we.exports={isValidStatusCode:ft,isValidUTF8:ct,tokenChars:lt}}});var Ne=S((ai,xt)=>{"use strict";var{Writable:Wr}=require("stream"),ht=z(),{BINARY_TYPES:qr,EMPTY_BUFFER:ut,kStatusCode:Fr,kWebSocket:$r}=L(),{concat:Oe,toArrayBuffer:Gr,unmask:jr}=j(),{isValidStatusCode:Vr,isValidUTF8:dt}=Y(),X=0,_t=1,pt=2,mt=3,Te=4,Hr=5,Ce=class extends Wr{constructor(e={}){super(),this._binaryType=e.binaryType||qr[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[$r]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=X,this._loop=!1}_write(e,r,i){if(this._opcode===8&&this._state==X)return i();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(i)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let i=this._buffers[0];return this._buffers[0]=i.slice(e),i.slice(0,e)}let r=Buffer.allocUnsafe(e);do{let i=this._buffers[0],s=r.length-e;e>=i.length?r.set(this._buffers.shift(),s):(r.set(new Uint8Array(i.buffer,i.byteOffset,e),s),this._buffers[0]=i.slice(e)),e-=i.length}while(e>0);return r}startLoop(e){let r;this._loop=!0;do switch(this._state){case X:r=this.getInfo();break;case _t:r=this.getPayloadLength16();break;case pt:r=this.getPayloadLength64();break;case mt:this.getMask();break;case Te:r=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(r)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if(e[0]&48)return this._loop=!1,m(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");let r=(e[0]&64)===64;if(r&&!this._extensions[ht.extensionName])return this._loop=!1,m(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(r)return this._loop=!1,m(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,m(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,m(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,m(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(r)return this._loop=!1,m(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125)return this._loop=!1,m(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,m(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,m(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,m(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=_t;else if(this._payloadLength===127)this._state=pt;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),r=e.readUInt32BE(0);return r>Math.pow(2,21)-1?(this._loop=!1,m(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=r*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,m(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=mt:this._state=Te}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Te}getData(e){let r=ut;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&jr(r,this._mask)}if(this._opcode>7)return this.controlMessage(r);if(this._compressed){this._state=Hr,this.decompress(r,e);return}return r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage()}decompress(e,r){this._extensions[ht.extensionName].decompress(e,this._fin,(s,n)=>{if(s)return r(s);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return r(m(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(n)}let o=this.dataMessage();if(o)return r(o);this.startLoop(r)})}dataMessage(){if(this._fin){let e=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let i;this._binaryType==="nodebuffer"?i=Oe(r,e):this._binaryType==="arraybuffer"?i=Gr(Oe(r,e)):i=r,this.emit("message",i,!0)}else{let i=Oe(r,e);if(!this._skipUTF8Validation&&!dt(i))return this._loop=!1,m(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",i,!1)}}this._state=X}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,ut),this.end();else{if(e.length===1)return m(RangeError,"invalid payload length 1",!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");{let r=e.readUInt16BE(0);if(!Vr(r))return m(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");let i=e.slice(2);if(!this._skipUTF8Validation&&!dt(i))return m(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",r,i),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=X}};xt.exports=Ce;function m(t,e,r,i,s){let n=new t(r?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(n,m),n.code=s,n[Fr]=i,n}});var Le=S((ci,St)=>{"use strict";var li=require("net"),fi=require("tls"),{randomFillSync:zr}=require("crypto"),gt=z(),{EMPTY_BUFFER:Yr}=L(),{isValidStatusCode:Xr}=Y(),{mask:yt,toBuffer:O}=j(),D=Buffer.alloc(4),ke=class t{constructor(e,r){this._extensions=r||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,r){let i=r.mask&&r.readOnly,s=r.mask?6:2,n=e.length;e.length>=65536?(s+=8,n=127):e.length>125&&(s+=2,n=126);let o=Buffer.allocUnsafe(i?e.length+s:s);return o[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(o[0]|=64),o[1]=n,n===126?o.writeUInt16BE(e.length,2):n===127&&(o.writeUInt32BE(0,2),o.writeUInt32BE(e.length,6)),r.mask?(zr(D,0,4),o[1]|=128,o[s-4]=D[0],o[s-3]=D[1],o[s-2]=D[2],o[s-1]=D[3],i?(yt(e,D,o,s,e.length),[o]):(yt(e,D,e,0,e.length),[o,e])):[o,e]}close(e,r,i,s){let n;if(e===void 0)n=Yr;else{if(typeof e!="number"||!Xr(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)n=Buffer.allocUnsafe(2),n.writeUInt16BE(e,0);else{let o=Buffer.byteLength(r);if(o>123)throw new RangeError("The message must not be greater than 123 bytes");n=Buffer.allocUnsafe(2+o),n.writeUInt16BE(e,0),typeof r=="string"?n.write(r,2):n.set(r,2)}}this._deflating?this.enqueue([this.doClose,n,i,s]):this.doClose(n,i,s)}doClose(e,r,i){this.sendFrame(t.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:r,readOnly:!1}),i)}ping(e,r,i){let s=O(e);if(s.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPing,s,r,O.readOnly,i]):this.doPing(s,r,O.readOnly,i)}doPing(e,r,i,s){this.sendFrame(t.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:r,readOnly:i}),s)}pong(e,r,i){let s=O(e);if(s.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPong,s,r,O.readOnly,i]):this.doPong(s,r,O.readOnly,i)}doPong(e,r,i,s){this.sendFrame(t.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:r,readOnly:i}),s)}send(e,r,i){let s=O(e),n=this._extensions[gt.extensionName],o=r.binary?2:1,l=r.compress;if(this._firstFragment?(this._firstFragment=!1,l&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(l=s.length>=n._threshold),this._compress=l):(l=!1,o=0),r.fin&&(this._firstFragment=!0),n){let a={fin:r.fin,rsv1:l,opcode:o,mask:r.mask,readOnly:O.readOnly};this._deflating?this.enqueue([this.dispatch,s,this._compress,a,i]):this.dispatch(s,this._compress,a,i)}else this.sendFrame(t.frame(s,{fin:r.fin,rsv1:!1,opcode:o,mask:r.mask,readOnly:O.readOnly}),i)}dispatch(e,r,i,s){if(!r){this.sendFrame(t.frame(e,i),s);return}let n=this._extensions[gt.extensionName];this._bufferedBytes+=e.length,this._deflating=!0,n.compress(e,i.fin,(o,l)=>{if(this._socket.destroyed){let a=new Error("The socket was closed while data was being compressed");typeof s=="function"&&s(a);for(let f=0;f<this._queue.length;f++){let c=this._queue[f][4];typeof c=="function"&&c(a)}return}this._bufferedBytes-=e.length,this._deflating=!1,i.readOnly=!1,this.sendFrame(t.frame(l,i),s),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[1].length,Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};St.exports=ke});var Lt=S((hi,kt)=>{"use strict";var{kForOnEventAttribute:Pe,kListener:vt}=L(),Et=Symbol("kCode"),bt=Symbol("kData"),wt=Symbol("kError"),Ot=Symbol("kMessage"),Tt=Symbol("kReason"),q=Symbol("kTarget"),Ct=Symbol("kType"),Nt=Symbol("kWasClean"),T=class{constructor(e){this[q]=null,this[Ct]=e}get target(){return this[q]}get type(){return this[Ct]}};Object.defineProperty(T.prototype,"target",{enumerable:!0});Object.defineProperty(T.prototype,"type",{enumerable:!0});var A=class extends T{constructor(e,r={}){super(e),this[Et]=r.code===void 0?0:r.code,this[Tt]=r.reason===void 0?"":r.reason,this[Nt]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[Et]}get reason(){return this[Tt]}get wasClean(){return this[Nt]}};Object.defineProperty(A.prototype,"code",{enumerable:!0});Object.defineProperty(A.prototype,"reason",{enumerable:!0});Object.defineProperty(A.prototype,"wasClean",{enumerable:!0});var F=class extends T{constructor(e,r={}){super(e),this[wt]=r.error===void 0?null:r.error,this[Ot]=r.message===void 0?"":r.message}get error(){return this[wt]}get message(){return this[Ot]}};Object.defineProperty(F.prototype,"error",{enumerable:!0});Object.defineProperty(F.prototype,"message",{enumerable:!0});var K=class extends T{constructor(e,r={}){super(e),this[bt]=r.data===void 0?null:r.data}get data(){return this[bt]}};Object.defineProperty(K.prototype,"data",{enumerable:!0});var Kr={addEventListener(t,e,r={}){let i;if(t==="message")i=function(n,o){let l=new K("message",{data:o?n:n.toString()});l[q]=this,e.call(this,l)};else if(t==="close")i=function(n,o){let l=new A("close",{code:n,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});l[q]=this,e.call(this,l)};else if(t==="error")i=function(n){let o=new F("error",{error:n,message:n.message});o[q]=this,e.call(this,o)};else if(t==="open")i=function(){let n=new T("open");n[q]=this,e.call(this,n)};else return;i[Pe]=!!r[Pe],i[vt]=e,r.once?this.once(t,i):this.on(t,i)},removeEventListener(t,e){for(let r of this.listeners(t))if(r[vt]===e&&!r[Pe]){this.removeListener(t,r);break}}};kt.exports={CloseEvent:A,ErrorEvent:F,Event:T,EventTarget:Kr,MessageEvent:K}});var Re=S((ui,Pt)=>{"use strict";var{tokenChars:Z}=Y();function b(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}function Zr(t){let e=Object.create(null),r=Object.create(null),i=!1,s=!1,n=!1,o,l,a=-1,f=-1,c=-1,h=0;for(;h<t.length;h++)if(f=t.charCodeAt(h),o===void 0)if(c===-1&&Z[f]===1)a===-1&&(a=h);else if(h!==0&&(f===32||f===9))c===-1&&a!==-1&&(c=h);else if(f===59||f===44){if(a===-1)throw new SyntaxError(`Unexpected character at index ${h}`);c===-1&&(c=h);let d=t.slice(a,c);f===44?(b(e,d,r),r=Object.create(null)):o=d,a=c=-1}else throw new SyntaxError(`Unexpected character at index ${h}`);else if(l===void 0)if(c===-1&&Z[f]===1)a===-1&&(a=h);else if(f===32||f===9)c===-1&&a!==-1&&(c=h);else if(f===59||f===44){if(a===-1)throw new SyntaxError(`Unexpected character at index ${h}`);c===-1&&(c=h),b(r,t.slice(a,c),!0),f===44&&(b(e,o,r),r=Object.create(null),o=void 0),a=c=-1}else if(f===61&&a!==-1&&c===-1)l=t.slice(a,h),a=c=-1;else throw new SyntaxError(`Unexpected character at index ${h}`);else if(s){if(Z[f]!==1)throw new SyntaxError(`Unexpected character at index ${h}`);a===-1?a=h:i||(i=!0),s=!1}else if(n)if(Z[f]===1)a===-1&&(a=h);else if(f===34&&a!==-1)n=!1,c=h;else if(f===92)s=!0;else throw new SyntaxError(`Unexpected character at index ${h}`);else if(f===34&&t.charCodeAt(h-1)===61)n=!0;else if(c===-1&&Z[f]===1)a===-1&&(a=h);else if(a!==-1&&(f===32||f===9))c===-1&&(c=h);else if(f===59||f===44){if(a===-1)throw new SyntaxError(`Unexpected character at index ${h}`);c===-1&&(c=h);let d=t.slice(a,c);i&&(d=d.replace(/\\/g,""),i=!1),b(r,l,d),f===44&&(b(e,o,r),r=Object.create(null),o=void 0),l=void 0,a=c=-1}else throw new SyntaxError(`Unexpected character at index ${h}`);if(a===-1||n||f===32||f===9)throw new SyntaxError("Unexpected end of input");c===-1&&(c=h);let u=t.slice(a,c);return o===void 0?b(e,u,r):(l===void 0?b(r,u,!0):i?b(r,l,u.replace(/\\/g,"")):b(r,l,u),b(e,o,r)),e}function Jr(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(i=>[e].concat(Object.keys(i).map(s=>{let n=i[s];return Array.isArray(n)||(n=[n]),n.map(o=>o===!0?s:`${s}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}Pt.exports={format:Jr,parse:Zr}});var Be=S((_i,Ft)=>{"use strict";var Qr=require("events"),es=require("https"),ts=require("http"),It=require("net"),rs=require("tls"),{randomBytes:ss,createHash:is}=require("crypto"),{Readable:di}=require("stream"),{URL:Ue}=require("url"),R=z(),ns=Ne(),os=Le(),{BINARY_TYPES:Rt,EMPTY_BUFFER:fe,GUID:as,kForOnEventAttribute:Ie,kListener:ls,kStatusCode:fs,kWebSocket:g,NOOP:Dt}=L(),{EventTarget:{addEventListener:cs,removeEventListener:hs}}=Lt(),{format:us,parse:ds}=Re(),{toBuffer:_s}=j(),C=["CONNECTING","OPEN","CLOSING","CLOSED"],ps=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,De=[8,13],ms=30*1e3,p=class t extends Qr{constructor(e,r,i){super(),this._binaryType=Rt[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=fe,this._closeTimer=null,this._extensions={},this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(i=r,r=[]):r=[r]),At(this,e,r,i)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){Rt.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,i){let s=new ns({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation});this._sender=new os(e,this._extensions),this._receiver=s,this._socket=e,s[g]=this,e[g]=this,s.on("conclude",ys),s.on("drain",Ss),s.on("error",vs),s.on("message",Es),s.on("ping",bs),s.on("pong",ws),e.setTimeout(0),e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",Mt),e.on("data",ce),e.on("end",Wt),e.on("error",qt),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[R.extensionName]&&this._extensions[R.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING)return E(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,r,!this._isServer,i=>{i||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),ms)}}ping(e,r,i){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(i=e,e=r=void 0):typeof r=="function"&&(i=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){Ae(this,e,i);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||fe,r,i)}pong(e,r,i){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(i=e,e=r=void 0):typeof r=="function"&&(i=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){Ae(this,e,i);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||fe,r,i)}send(e,r,i){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(i=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){Ae(this,e,i);return}let s={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[R.extensionName]||(s.compress=!1),this._sender.send(e||fe,s,i)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING)return E(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty(p,"CONNECTING",{enumerable:!0,value:C.indexOf("CONNECTING")});Object.defineProperty(p.prototype,"CONNECTING",{enumerable:!0,value:C.indexOf("CONNECTING")});Object.defineProperty(p,"OPEN",{enumerable:!0,value:C.indexOf("OPEN")});Object.defineProperty(p.prototype,"OPEN",{enumerable:!0,value:C.indexOf("OPEN")});Object.defineProperty(p,"CLOSING",{enumerable:!0,value:C.indexOf("CLOSING")});Object.defineProperty(p.prototype,"CLOSING",{enumerable:!0,value:C.indexOf("CLOSING")});Object.defineProperty(p,"CLOSED",{enumerable:!0,value:C.indexOf("CLOSED")});Object.defineProperty(p.prototype,"CLOSED",{enumerable:!0,value:C.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","protocol","readyState","url"].forEach(t=>{Object.defineProperty(p.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(p.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[Ie])return e[ls];return null},set(e){for(let r of this.listeners(t))if(r[Ie]){this.removeListener(t,r);break}typeof e=="function"&&this.addEventListener(t,e,{[Ie]:!0})}})});p.prototype.addEventListener=cs;p.prototype.removeEventListener=hs;Ft.exports=p;function At(t,e,r,i){let s={protocolVersion:De[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...i,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0};if(!De.includes(s.protocolVersion))throw new RangeError(`Unsupported protocol version: ${s.protocolVersion} (supported versions: ${De.join(", ")})`);let n;if(e instanceof Ue)n=e,t._url=e.href;else{try{n=new Ue(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}t._url=e}let o=n.protocol==="wss:",l=n.protocol==="ws+unix:";if(n.protocol!=="ws:"&&!o&&!l)throw new SyntaxError(`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`);if(l&&!n.pathname)throw new SyntaxError("The URL's pathname is empty");if(n.hash)throw new SyntaxError("The URL contains a fragment identifier");let a=o?443:80,f=ss(16).toString("base64"),c=o?es.get:ts.get,h=new Set,u;if(s.createConnection=o?gs:xs,s.defaultPort=s.defaultPort||a,s.port=n.port||a,s.host=n.hostname.startsWith("[")?n.hostname.slice(1,-1):n.hostname,s.headers={"Sec-WebSocket-Version":s.protocolVersion,"Sec-WebSocket-Key":f,Connection:"Upgrade",Upgrade:"websocket",...s.headers},s.path=n.pathname+n.search,s.timeout=s.handshakeTimeout,s.perMessageDeflate&&(u=new R(s.perMessageDeflate!==!0?s.perMessageDeflate:{},!1,s.maxPayload),s.headers["Sec-WebSocket-Extensions"]=us({[R.extensionName]:u.offer()})),r.length){for(let _ of r){if(typeof _!="string"||!ps.test(_)||h.has(_))throw new SyntaxError("An invalid or duplicated subprotocol was specified");h.add(_)}s.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(s.origin&&(s.protocolVersion<13?s.headers["Sec-WebSocket-Origin"]=s.origin:s.headers.Origin=s.origin),(n.username||n.password)&&(s.auth=`${n.username}:${n.password}`),l){let _=s.path.split(":");s.socketPath=_[0],s.path=_[1]}let d=t._req=c(s);s.timeout&&d.on("timeout",()=>{E(t,d,"Opening handshake has timed out")}),d.on("error",_=>{d===null||d.aborted||(d=t._req=null,t._readyState=p.CLOSING,t.emit("error",_),t.emitClose())}),d.on("response",_=>{let v=_.headers.location,re=_.statusCode;if(v&&s.followRedirects&&re>=300&&re<400){if(++t._redirects>s.maxRedirects){E(t,d,"Maximum redirects exceeded");return}d.abort();let me=new Ue(v,e);At(t,me,r,i)}else t.emit("unexpected-response",d,_)||E(t,d,`Unexpected server response: ${_.statusCode}`)}),d.on("upgrade",(_,v,re)=>{if(t.emit("upgrade",_),t.readyState!==p.CONNECTING)return;d=t._req=null;let me=is("sha1").update(f+as).digest("base64");if(_.headers["sec-websocket-accept"]!==me){E(t,v,"Invalid Sec-WebSocket-Accept header");return}let se=_.headers["sec-websocket-protocol"],G;if(se!==void 0?h.size?h.has(se)||(G="Server sent an invalid subprotocol"):G="Server sent a subprotocol but none was requested":h.size&&(G="Server sent no subprotocol"),G){E(t,v,G);return}se&&(t._protocol=se);let ze=_.headers["sec-websocket-extensions"];if(ze!==void 0){if(!u){E(t,v,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let xe;try{xe=ds(ze)}catch{E(t,v,"Invalid Sec-WebSocket-Extensions header");return}let Ye=Object.keys(xe);if(Ye.length!==1||Ye[0]!==R.extensionName){E(t,v,"Server indicated an extension that was not requested");return}try{u.accept(xe[R.extensionName])}catch{E(t,v,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[R.extensionName]=u}t.setSocket(v,re,{maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation})})}function xs(t){return t.path=t.socketPath,It.connect(t)}function gs(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=It.isIP(t.host)?"":t.host),rs.connect(t)}function E(t,e,r){t._readyState=p.CLOSING;let i=new Error(r);Error.captureStackTrace(i,E),e.setHeader?(e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),e.once("abort",t.emitClose.bind(t)),t.emit("error",i)):(e.destroy(i),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function Ae(t,e,r){if(e){let i=_s(e).length;t._socket?t._sender._bufferedBytes+=i:t._bufferedAmount+=i}if(r){let i=new Error(`WebSocket is not open: readyState ${t.readyState} (${C[t.readyState]})`);r(i)}}function ys(t,e){let r=this[g];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[g]!==void 0&&(r._socket.removeListener("data",ce),process.nextTick(Bt,r._socket),t===1005?r.close():r.close(t,e))}function Ss(){this[g]._socket.resume()}function vs(t){let e=this[g];e._socket[g]!==void 0&&(e._socket.removeListener("data",ce),process.nextTick(Bt,e._socket),e.close(t[fs])),e.emit("error",t)}function Ut(){this[g].emitClose()}function Es(t,e){this[g].emit("message",t,e)}function bs(t){let e=this[g];e.pong(t,!e._isServer,Dt),e.emit("ping",t)}function ws(t){this[g].emit("pong",t)}function Bt(t){t.resume()}function Mt(){let t=this[g];this.removeListener("close",Mt),this.removeListener("data",ce),this.removeListener("end",Wt),t._readyState=p.CLOSING;let e;!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&(e=t._socket.read())!==null&&t._receiver.write(e),t._receiver.end(),this[g]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",Ut),t._receiver.on("finish",Ut))}function ce(t){this[g]._receiver.write(t)||this.pause()}function Wt(){let t=this[g];t._readyState=p.CLOSING,t._receiver.end(),this.end()}function qt(){let t=this[g];this.removeListener("error",qt),this.on("error",Dt),t&&(t._readyState=p.CLOSING,this.destroy())}});var Vt=S((pi,jt)=>{"use strict";var{Duplex:Os}=require("stream");function $t(t){t.emit("close")}function Ts(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Gt(t){this.removeListener("error",Gt),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function Cs(t,e){let r=!0,i=!0;function s(){r&&t._socket.resume()}t.readyState===t.CONNECTING?t.once("open",function(){t._receiver.removeAllListeners("drain"),t._receiver.on("drain",s)}):(t._receiver.removeAllListeners("drain"),t._receiver.on("drain",s));let n=new Os({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(l,a){let f=!a&&n._readableState.objectMode?l.toString():l;n.push(f)||(r=!1,t._socket.pause())}),t.once("error",function(l){n.destroyed||(i=!1,n.destroy(l))}),t.once("close",function(){n.destroyed||n.push(null)}),n._destroy=function(o,l){if(t.readyState===t.CLOSED){l(o),process.nextTick($t,n);return}let a=!1;t.once("error",function(c){a=!0,l(c)}),t.once("close",function(){a||l(o),process.nextTick($t,n)}),i&&t.terminate()},n._final=function(o){if(t.readyState===t.CONNECTING){t.once("open",function(){n._final(o)});return}t._socket!==null&&(t._socket._writableState.finished?(o(),n._readableState.endEmitted&&n.destroy()):(t._socket.once("finish",function(){o()}),t.close()))},n._read=function(){t.readyState===t.OPEN&&!r&&(r=!0,t._receiver._writableState.needDrain||t._socket.resume())},n._write=function(o,l,a){if(t.readyState===t.CONNECTING){t.once("open",function(){n._write(o,l,a)});return}t.send(o,a)},n.on("end",Ts),n.on("error",Gt),n}jt.exports=Cs});var zt=S((mi,Ht)=>{"use strict";var{tokenChars:Ns}=Y();function ks(t){let e=new Set,r=-1,i=-1,s=0;for(s;s<t.length;s++){let o=t.charCodeAt(s);if(i===-1&&Ns[o]===1)r===-1&&(r=s);else if(s!==0&&(o===32||o===9))i===-1&&r!==-1&&(i=s);else if(o===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${s}`);i===-1&&(i=s);let l=t.slice(r,i);if(e.has(l))throw new SyntaxError(`The "${l}" subprotocol is duplicated`);e.add(l),r=i=-1}else throw new SyntaxError(`Unexpected character at index ${s}`)}if(r===-1||i!==-1)throw new SyntaxError("Unexpected end of input");let n=t.slice(r,s);if(e.has(n))throw new SyntaxError(`The "${n}" subprotocol is duplicated`);return e.add(n),e}Ht.exports={parse:ks}});var Qt=S((Si,Jt)=>{"use strict";var Ls=require("events"),he=require("http"),xi=require("https"),gi=require("net"),yi=require("tls"),{createHash:Ps}=require("crypto"),Yt=Re(),B=z(),Rs=zt(),Us=Be(),{GUID:Is,kWebSocket:Ds}=L(),As=/^[+/0-9A-Za-z]{22}==$/,Xt=0,Kt=1,Zt=2,Me=class extends Ls{constructor(e,r){if(super(),e={maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=he.createServer((i,s)=>{let n=he.STATUS_CODES[426];s.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),s.end(n)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let i=this.emit.bind(this,"connection");this._removeListeners=Bs(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(s,n,o)=>{this.handleUpgrade(s,n,o,i)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=Xt}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===Zt){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(J,this);return}if(e&&this.once("close",e),this._state!==Kt)if(this._state=Kt,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(J,this):process.nextTick(J,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{J(this)})}}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,i,s){r.on("error",We);let n=e.headers["sec-websocket-key"]!==void 0?e.headers["sec-websocket-key"]:!1,o=+e.headers["sec-websocket-version"];if(e.method!=="GET"||e.headers.upgrade.toLowerCase()!=="websocket"||!n||!As.test(n)||o!==8&&o!==13||!this.shouldHandle(e))return $(r,400);let l=e.headers["sec-websocket-protocol"],a=new Set;if(l!==void 0)try{a=Rs.parse(l)}catch{return $(r,400)}let f=e.headers["sec-websocket-extensions"],c={};if(this.options.perMessageDeflate&&f!==void 0){let h=new B(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let u=Yt.parse(f);u[B.extensionName]&&(h.accept(u[B.extensionName]),c[B.extensionName]=h)}catch{return $(r,400)}}if(this.options.verifyClient){let h={origin:e.headers[`${o===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(h,(u,d,_,v)=>{if(!u)return $(r,d||401,_,v);this.completeUpgrade(c,n,a,e,r,i,s)});return}if(!this.options.verifyClient(h))return $(r,401)}this.completeUpgrade(c,n,a,e,r,i,s)}completeUpgrade(e,r,i,s,n,o,l){if(!n.readable||!n.writable)return n.destroy();if(n[Ds])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Xt)return $(n,503);let f=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Ps("sha1").update(r+Is).digest("base64")}`],c=new Us(null);if(i.size){let h=this.options.handleProtocols?this.options.handleProtocols(i,s):i.values().next().value;h&&(f.push(`Sec-WebSocket-Protocol: ${h}`),c._protocol=h)}if(e[B.extensionName]){let h=e[B.extensionName].params,u=Yt.format({[B.extensionName]:[h]});f.push(`Sec-WebSocket-Extensions: ${u}`),c._extensions=e}this.emit("headers",f,s),n.write(f.concat(`\r
`).join(`\r
`)),n.removeListener("error",We),c.setSocket(n,o,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(c),c.on("close",()=>{this.clients.delete(c),this._shouldEmitClose&&!this.clients.size&&process.nextTick(J,this)})),l(c,s)}};Jt.exports=Me;function Bs(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return function(){for(let i of Object.keys(e))t.removeListener(i,e[i])}}function J(t){t._state=Zt,t.emit("close")}function We(){this.destroy()}function $(t,e,r,i){t.writable&&(r=r||he.STATUS_CODES[e],i={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...i},t.write(`HTTP/1.1 ${e} ${he.STATUS_CODES[e]}\r
`+Object.keys(i).map(s=>`${s}: ${i[s]}`).join(`\r
`)+`\r
\r
`+r)),t.removeListener("error",We),t.destroy()}});var tr=S((vi,er)=>{"use strict";var N=Be();N.createWebSocketStream=Vt();N.Server=Qt();N.Receiver=Ne();N.Sender=Le();N.WebSocket=N;N.WebSocketServer=N.Server;er.exports=N});function Q(){return ue>de.length-16&&(rr.default.randomFillSync(de),ue=0),de.slice(ue,ue+=16)}var rr,de,ue,qe=y(()=>{rr=ye(require("crypto")),de=new Uint8Array(256),ue=de.length});var sr,ir=y(()=>{sr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i});function Ms(t){return typeof t=="string"&&sr.test(t)}var U,ee=y(()=>{ir();U=Ms});function Ws(t,e=0){let r=(x[t[e+0]]+x[t[e+1]]+x[t[e+2]]+x[t[e+3]]+"-"+x[t[e+4]]+x[t[e+5]]+"-"+x[t[e+6]]+x[t[e+7]]+"-"+x[t[e+8]]+x[t[e+9]]+"-"+x[t[e+10]]+x[t[e+11]]+x[t[e+12]]+x[t[e+13]]+x[t[e+14]]+x[t[e+15]]).toLowerCase();if(!U(r))throw TypeError("Stringified UUID is invalid");return r}var x,I,te=y(()=>{ee();x=[];for(let t=0;t<256;++t)x.push((t+256).toString(16).substr(1));I=Ws});function qs(t,e,r){let i=e&&r||0,s=e||new Array(16);t=t||{};let n=t.node||nr,o=t.clockseq!==void 0?t.clockseq:Fe;if(n==null||o==null){let u=t.random||(t.rng||Q)();n==null&&(n=nr=[u[0]|1,u[1],u[2],u[3],u[4],u[5]]),o==null&&(o=Fe=(u[6]<<8|u[7])&16383)}let l=t.msecs!==void 0?t.msecs:Date.now(),a=t.nsecs!==void 0?t.nsecs:Ge+1,f=l-$e+(a-Ge)/1e4;if(f<0&&t.clockseq===void 0&&(o=o+1&16383),(f<0||l>$e)&&t.nsecs===void 0&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");$e=l,Ge=a,Fe=o,l+=122192928e5;let c=((l&268435455)*1e4+a)%4294967296;s[i++]=c>>>24&255,s[i++]=c>>>16&255,s[i++]=c>>>8&255,s[i++]=c&255;let h=l/4294967296*1e4&268435455;s[i++]=h>>>8&255,s[i++]=h&255,s[i++]=h>>>24&15|16,s[i++]=h>>>16&255,s[i++]=o>>>8|128,s[i++]=o&255;for(let u=0;u<6;++u)s[i+u]=n[u];return e||I(s)}var nr,Fe,$e,Ge,or,ar=y(()=>{qe();te();$e=0,Ge=0;or=qs});function Fs(t){if(!U(t))throw TypeError("Invalid UUID");let e,r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=e&255,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=e&255,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=e&255,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=e&255,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=e&255,r}var _e,je=y(()=>{ee();_e=Fs});function $s(t){t=unescape(encodeURIComponent(t));let e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e}function pe(t,e,r){function i(s,n,o,l){if(typeof s=="string"&&(s=$s(s)),typeof n=="string"&&(n=_e(n)),n.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+s.length);if(a.set(n),a.set(s,n.length),a=r(a),a[6]=a[6]&15|e,a[8]=a[8]&63|128,o){l=l||0;for(let f=0;f<16;++f)o[l+f]=a[f];return o}return I(a)}try{i.name=t}catch{}return i.DNS=Gs,i.URL=js,i}var Gs,js,Ve=y(()=>{te();je();Gs="6ba7b810-9dad-11d1-80b4-00c04fd430c8",js="6ba7b811-9dad-11d1-80b4-00c04fd430c8"});function Vs(t){return Array.isArray(t)?t=Buffer.from(t):typeof t=="string"&&(t=Buffer.from(t,"utf8")),lr.default.createHash("md5").update(t).digest()}var lr,fr,cr=y(()=>{lr=ye(require("crypto"));fr=Vs});var Hs,hr,ur=y(()=>{Ve();cr();Hs=pe("v3",48,fr),hr=Hs});function zs(t,e,r){t=t||{};let i=t.random||(t.rng||Q)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){r=r||0;for(let s=0;s<16;++s)e[r+s]=i[s];return e}return I(i)}var dr,_r=y(()=>{qe();te();dr=zs});function Ys(t){return Array.isArray(t)?t=Buffer.from(t):typeof t=="string"&&(t=Buffer.from(t,"utf8")),pr.default.createHash("sha1").update(t).digest()}var pr,mr,xr=y(()=>{pr=ye(require("crypto"));mr=Ys});var Xs,gr,yr=y(()=>{Ve();xr();Xs=pe("v5",80,mr),gr=Xs});var Sr,vr=y(()=>{Sr="00000000-0000-0000-0000-000000000000"});function Ks(t){if(!U(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)}var Er,br=y(()=>{ee();Er=Ks});var wr={};Rr(wr,{NIL:()=>Sr,parse:()=>_e,stringify:()=>I,v1:()=>or,v3:()=>hr,v4:()=>dr,v5:()=>gr,validate:()=>U,version:()=>Er});var Or=y(()=>{ar();ur();_r();yr();vr();br();ee();te();je()});var k=require("vscode"),M=null,He=!1,W=[];async function Zs(t){let{Server:e}=tr(),{v4:r}=(Or(),Ur(wr));if((await k.workspace.findFiles("**/manifest.json","**/node_modules/**",1)).length===0)return;let s=k.window.createStatusBarItem(k.StatusBarAlignment.Right,100);s.text="$(debug-start) AutoReload",s.tooltip="Press to start the websocket server",s.command="extension.toggleAutoReload",s.show(),t.subscriptions.push(s);let n=k.commands.registerCommand("extension.toggleAutoReload",async()=>{He=!He,He?(s.text="$(sync) AutoReload",s.tooltip="Run /wsserver localhost:8080 to connect",M=new e({port:8080}),M.on("connection",o=>{W.push(o);let l=k.workspace.onDidSaveTextDocument(()=>{let a=k.workspace.getConfiguration().get("extension.autoReloadDelay",0);setTimeout(()=>{Qs("/reload",o,r())},a)});t.subscriptions.push(l),o.on("close",()=>{l.dispose();let a=W.indexOf(o);a>-1&&W.splice(a,1)})}),await k.env.clipboard.writeText("/wsserver localhost:8080"),ei("wsserver connect command copied to clipboard",3e3)):(s.text="$(debug-start) AutoReload",s.tooltip="Press to start the websocket server",M&&await new Promise(o=>{W.forEach(l=>l.close()),W=[],M.close(o),M=null}))});t.subscriptions.push(n)}function Js(){M&&(W.forEach(t=>t.close()),W=[],M.close())}function Qs(t,e,r){let i={header:{version:1,requestId:r,messagePurpose:"commandRequest",messageType:"commandRequest"},body:{version:1,commandLine:t}};e.send(JSON.stringify(i))}function ei(t,e){k.window.withProgress({location:k.ProgressLocation.Notification,title:t,cancellable:!1},()=>new Promise(r=>{setTimeout(r,e)}))}module.exports={activate:Zs,deactivate:Js};
